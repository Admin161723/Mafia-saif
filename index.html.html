<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mafia Safe</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #000;
            color: #fff;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }
        
        /* صفحه ورود */
        .login-container {
            position: relative;
            height: 100vh;
            width: 100vw;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: url('https://abrehamrahi.ir/s/u/yjmUhJeM/') no-repeat center center;
            background-size: cover;
        }
        
        .login-form {
            background-color: rgba(0, 0, 0, 0.7);
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }
        
        .app-title {
            font-size: 32px;
            margin-bottom: 30px;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        .input-group {
            margin-bottom: 20px;
            text-align: right;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .input-group input {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #444;
            background-color: #222;
            color: #fff;
            font-size: 16px;
        }
        
        .avatar-selection {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
        }
        
        .avatar-option {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            overflow: hidden;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .avatar-option.selected {
            border-color: #ffd700;
            box-shadow: 0 0 10px #ffd700;
        }
        
        .avatar-option img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .login-btn {
            background: linear-gradient(to bottom, #ffd700, #ff9900);
            color: #000;
            border: none;
            padding: 15px;
            width: 100%;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s;
        }
        
        .login-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.7);
        }
        
        .register-link {
            margin-top: 20px;
            font-size: 14px;
        }
        
        .register-link a {
            color: #ffd700;
            text-decoration: none;
        }
        
        /* صفحه اصلی */
        .main-container {
            position: relative;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }
        
        .video-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
        }
        
        .bottom-nav {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 80px;
            background: url('https://abrehamrahi.ir/s/u/mRre2tBy/') no-repeat center center;
            background-size: cover;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 10px;
            z-index: 10;
        }
        
        .nav-item {
            width: 60px;
            height: 60px;
            cursor: pointer;
            transition: all 0.3s;
            filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.7));
        }
        
        .nav-item:hover {
            transform: scale(1.2);
        }
        
        .nav-item img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .profile-section {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            align-items: center;
            padding: 12px;
            border-radius: 20px;
            z-index: 5;
            background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(139,69,19,0.2));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,215,0,0.3);
            box-shadow: 0 0 15px rgba(255,215,0,0.2);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .profile-section:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255,215,0,0.4);
        }
        
        .profile-avatar-container {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            overflow: hidden;
            margin-right: 12px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .profile-avatar-frame {
            position: absolute;
            width: 100%;
            height: 100%;
            z-index: 2;
        }
        
        .profile-avatar {
            width: 85%;
            height: 85%;
            border-radius: 50%;
            overflow: hidden;
            z-index: 1;
        }
        
        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .profile-info {
            text-align: right;
        }
        
        .profile-name {
            font-size: 16px;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.7);
        }
        
        .profile-stats {
            font-size: 11px;
            color: #ccc;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.7);
        }
        
        .start-game {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 70px;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 5;
        }
        
        .start-game:hover {
            transform: translateX(-50%) scale(1.1);
        }
        
        .start-game img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .coins-display {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 18px;
            color: #ffd700;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.7);
            background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(139,69,19,0.2));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,215,0,0.3);
            box-shadow: 0 0 15px rgba(255,215,0,0.2);
        }
        
        .coins-display img {
            width: 25px;
            height: 25px;
            margin-left: 8px;
        }
        
        /* صفحه دوستانه */
        .friends-container {
            position: relative;
            height: 100vh;
            width: 100vw;
            background: url('https://abrehamrahi.ir/s/u/x4PH36pA/') no-repeat center center;
            background-size: cover;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 60px;
        }
        
        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 50px;
            height: 50px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .back-btn:hover {
            transform: scale(1.1);
        }
        
        .back-btn img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .create-lobby {
            position: absolute;
            bottom: 100px;
            width: 200px;
            height: 60px;
            cursor: pointer;
        }
        
        .create-lobby img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        /* لیست لابی‌ها */
        .lobbies-container {
            width: 90%;
            max-width: 800px;
            height: 70vh;
            overflow-y: auto;
            margin-top: 20px;
            padding: 10px;
        }
        
        .lobby-item {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .lobby-item:hover {
            transform: scale(1.02);
            border-color: #ffd700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
        }
        
        .lobby-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            overflow: hidden;
            margin-left: 15px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .lobby-avatar-frame {
            position: absolute;
            width: 100%;
            height: 100%;
            z-index: 2;
        }
        
        .lobby-avatar-img {
            width: 85%;
            height: 85%;
            border-radius: 50%;
            overflow: hidden;
            z-index: 1;
        }
        
        .lobby-avatar-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .lobby-info {
            flex: 1;
        }
        
        .lobby-name {
            font-size: 18px;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 5px;
        }
        
        .lobby-creator {
            font-size: 14px;
            color: #ccc;
        }
        
        .join-btn {
            background: linear-gradient(to bottom, #ffd700, #ff9900);
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .join-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.7);
        }
        
        /* صفحه پروفایل */
        .profile-page {
            position: relative;
            height: 100vh;
            width: 100vw;
            background: linear-gradient(to bottom, #1a1a2e, #16213e);
            overflow-y: auto;
            padding: 20px;
        }
        
        .profile-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .profile-avatar-large-container {
            width: 110px;
            height: 110px;
            border-radius: 50%;
            overflow: hidden;
            margin-left: 20px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .profile-frame-large {
            position: absolute;
            width: 100%;
            height: 100%;
            z-index: 2;
        }
        
        .profile-avatar-large {
            width: 85%;
            height: 85%;
            border-radius: 50%;
            overflow: hidden;
            z-index: 1;
        }
        
        .profile-avatar-large img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .profile-details {
            flex: 1;
        }
        
        .profile-stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-item {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #ffd700;
        }
        
        .stat-label {
            font-size: 14px;
            color: #ccc;
            margin-top: 5px;
        }
        
        .profile-tabs {
            display: flex;
            margin: 30px 0 20px;
            border-bottom: 1px solid #444;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }
        
        .tab.active {
            border-bottom: 2px solid #ffd700;
            color: #ffd700;
        }
        
        .tab-content {
            margin-top: 20px;
        }
        
        .avatar-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }
        
        .avatar-item {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .avatar-item:hover {
            transform: scale(1.05);
            background-color: rgba(255, 215, 0, 0.2);
        }
        
        .avatar-item.selected {
            border: 2px solid #ffd700;
            background-color: rgba(255, 215, 0, 0.3);
        }
        
        .avatar-item img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 10px;
        }
        
        .avatar-price {
            color: #ffd700;
            font-weight: bold;
        }
        
        .frame-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .frame-item {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            text-align: center;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .frame-item:hover {
            transform: scale(1.05);
            background-color: rgba(255, 215, 0, 0.2);
        }
        
        .frame-item.selected {
            border: 2px solid #ffd700;
            background-color: rgba(255, 215, 0, 0.3);
        }
        
        .frame-item img {
            width: 100px;
            height: 100px;
            object-fit: contain;
            margin-bottom: 10px;
        }
        
        .frame-price {
            color: #ffd700;
            font-weight: bold;
        }
        
        .buy-btn {
            background: linear-gradient(to bottom, #ffd700, #ff9900);
            color: #000;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s;
        }
        
        .buy-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.7);
        }
        
        .buy-btn:disabled {
            background: #666;
            color: #999;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .buy-btn.owned {
            background: #28a745;
            color: white;
        }
        
        /* صفحه فروشگاه */
        .shop-container {
            position: relative;
            height: 100vh;
            width: 100vw;
            background: url('https://abrehamrahi.ir/s/u/USmlCy8a/') no-repeat center center;
            background-size: cover;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 60px;
        }
        
        .shop-items {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 30px;
            width: 90%;
            max-width: 600px;
        }
        
        .shop-item {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
        }
        
        .shop-item:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
        }
        
        .shop-item img {
            width: 100px;
            height: 100px;
            object-fit: contain;
            margin-bottom: 15px;
        }
        
        .shop-item-name {
            font-size: 18px;
            color: #ffd700;
            margin-bottom: 10px;
        }
        
        .shop-item-price {
            font-size: 16px;
            color: #fff;
            margin-bottom: 15px;
        }
        
        /* صفحه گروه */
        .group-container {
            position: relative;
            height: 100vh;
            width: 100vw;
            background: linear-gradient(to bottom, #0f2027, #203a43, #2c5364);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 60px;
        }
        
        .group-list {
            width: 90%;
            max-width: 800px;
            height: 70vh;
            overflow-y: auto;
            margin-top: 20px;
            padding: 10px;
        }
        
        .group-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .group-item:hover {
            transform: scale(1.02);
            background: rgba(255, 215, 0, 0.2);
        }
        
        .group-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            overflow: hidden;
            margin-left: 15px;
        }
        
        .group-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .group-info {
            flex: 1;
        }
        
        .group-name {
            font-size: 18px;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 5px;
        }
        
        .group-members {
            font-size: 14px;
            color: #ccc;
        }
        
        /* صفحه ایجاد لابی */
        .create-lobby-container {
            position: relative;
            height: 100vh;
            width: 100vw;
            background: url('https://abrehamrahi.ir/s/u/3gpsFN5K/') no-repeat center center;
            background-size: cover;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 80px;
        }
        
        .lobby-form {
            background-color: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 15px;
            width: 90%;
            max-width: 350px;
            text-align: center;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
            margin-top: 20px;
        }
        
        .lobby-title {
            font-size: 22px;
            margin-bottom: 15px;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        .lobby-input-group {
            margin-bottom: 12px;
            text-align: right;
        }
        
        .lobby-input-group label {
            display: block;
            margin-bottom: 6px;
            font-size: 13px;
            color: #ffd700;
        }
        
        .lobby-input-group input {
            width: 100%;
            padding: 8px;
            border-radius: 8px;
            border: 1px solid #444;
            background-color: #222;
            color: #fff;
            font-size: 13px;
        }
        
        .lobby-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 15px 0;
        }
        
        .lobby-option {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .lobby-option:hover {
            transform: scale(1.03);
            background-color: rgba(255, 215, 0, 0.2);
        }
        
        .lobby-option.selected {
            border: 2px solid #ffd700;
            background-color: rgba(255, 215, 0, 0.3);
        }
        
        .lobby-option img {
            width: 40px;
            height: 40px;
            object-fit: cover;
            border-radius: 6px;
            margin-bottom: 5px;
        }
        
        .lobby-option div {
            font-size: 12px;
        }
        
        .create-lobby-btn {
            background: linear-gradient(to bottom, #ffd700, #ff9900);
            color: #000;
            border: none;
            padding: 10px;
            width: 100%;
            border-radius: 8px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s;
        }
        
        .create-lobby-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.7);
        }
        
        /* صفحه لابی */
        .lobby-container {
            position: relative;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }
        
        .lobby-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
        }
        
        .lobby-back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 60px;
            height: 60px;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 10;
        }
        
        .lobby-back-btn:hover {
            transform: scale(1.1);
        }
        
        .lobby-back-btn img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .lobby-info-header {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 10px;
            text-align: center;
            z-index: 5;
        }
        
        .lobby-title {
            font-size: 20px;
            font-weight: bold;
            color: #ffd700;
        }
        
        .lobby-creator-name {
            font-size: 14px;
            color: #ccc;
        }
        
        /* صندلی‌ها */
        .seats-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 95%;
            height: 60%;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 20px;
            padding: 10px;
        }
        
        .seat {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            transition: all 0.3s;
        }
        
        .seat-chair {
            width: 100px;
            height: 100px;
            background: url('https://abrehamrahi.ir/s/u/pXkLcMSf/') no-repeat center center;
            background-size: contain;
            position: relative;
            margin-bottom: 5px;
        }
        
        .seat-avatar-container {
            width: 70px;
            height: 70px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2;
        }
        
        .seat-avatar-frame {
            position: absolute;
            width: 100%;
            height: 100%;
            z-index: 2;
        }
        
        .seat-avatar {
            width: 85%;
            height: 85%;
            border-radius: 50%;
            overflow: hidden;
            z-index: 1;
        }
        
        .seat-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .seat-name {
            font-size: 12px;
            color: #fff;
            text-align: center;
            margin-bottom: 5px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            background: rgba(0, 0, 0, 0.5);
            padding: 3px 8px;
            border-radius: 10px;
        }
        
        .seat-number {
            position: absolute;
            top: -10px;
            left: -10px;
            width: 25px;
            height: 25px;
            background: #ffd700;
            color: #000;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            z-index: 3;
        }
        
        .seat-reactions {
            position: absolute;
            top: 5px;
            right: 5px;
            display: flex;
            gap: 3px;
            z-index: 3;
        }
        
        .reaction {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.7);
        }
        
        .reaction img {
            width: 15px;
            height: 15px;
        }
        
        .mic-indicator {
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            height: 4px;
            border-radius: 5px;
            background: transparent;
            transition: all 0.3s;
            z-index: 1;
        }
        
        .mic-active {
            background: #007bff;
            box-shadow: 0 0 8px #007bff;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }
        
        /* کنترل‌های لابی */
        .lobby-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 120px;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 20px;
            z-index: 10;
        }
        
        .lobby-control {
            width: 70px;
            height: 70px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .lobby-control:hover {
            transform: scale(1.1);
        }
        
        .lobby-control img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .mic-control {
            position: relative;
        }
        
        .mic-status {
            position: absolute;
            bottom: -5px;
            right: -5px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: #ff0000;
            border: 2px solid #000;
        }
        
        .mic-status.active {
            background-color: #00ff00;
        }
        
        .lobby-chat {
            position: absolute;
            bottom: 130px;
            right: 20px;
            width: 300px;
            height: 200px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            padding: 10px;
            overflow-y: auto;
            z-index: 5;
        }
        
        .chat-message {
            margin-bottom: 10px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            font-size: 14px;
        }
        
        .chat-message .sender {
            color: #ffd700;
            font-weight: bold;
        }
        
        /* انیمیشن واکنش‌ها */
        .reaction-temporary {
            animation: fadeReaction 3s forwards;
        }
        
        .dislike-temporary {
            animation: fadeReaction 3s forwards;
        }
        
        @keyframes fadeReaction {
            0% { opacity: 1; transform: scale(1); }
            70% { opacity: 1; transform: scale(1.5); }
            100% { opacity: 0; transform: scale(0.5); }
        }
        
        /* واکنش بزرگ در مرکز صفحه */
        .fullscreen-reaction {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            pointer-events: none;
        }
        
        .fullscreen-reaction img {
            width: 150px;
            height: 150px;
            animation: fadeReactionFullscreen 3s forwards;
        }
        
        @keyframes fadeReactionFullscreen {
            0% { opacity: 1; transform: scale(1); }
            70% { opacity: 1; transform: scale(1.2); }
            100% { opacity: 0; transform: scale(0.5); }
        }
        
        /* پیام خالی بودن لابی‌ها */
        .empty-lobbies {
            text-align: center;
            padding: 40px;
            color: #ccc;
            font-size: 18px;
        }
        
        .hidden {
            display: none;
        }
        
        /* پیام خالی بودن فروشگاه */
        .empty-shop {
            text-align: center;
            padding: 40px;
            color: #ccc;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <!-- صفحه ورود -->
    <div id="loginPage" class="login-container">
        <div class="login-form">
            <h1 class="app-title">Mafia Safe</h1>
            <div class="input-group">
                <label for="phone">شماره موبایل</label>
                <input type="tel" id="phone" placeholder="09xxxxxxxxx">
            </div>
            <div class="input-group">
                <label for="username">نام کاربری</label>
                <input type="text" id="username" placeholder="نام کاربری خود را وارد کنید">
            </div>
            <div class="input-group">
                <label for="password">رمز عبور</label>
                <input type="password" id="password" placeholder="رمز عبور خود را وارد کنید">
            </div>
            <div class="input-group">
                <label for="confirmPassword">تکرار رمز عبور</label>
                <input type="password" id="confirmPassword" placeholder="رمز عبور خود را تکرار کنید">
            </div>
            
            <div class="input-group">
                <label>انتخاب آواتار</label>
                <div class="avatar-selection">
                    <div class="avatar-option selected" data-gender="male">
                        <img src="https://abrehamrahi.ir/s/u/gS4i0cw6/" alt="آواتار مرد">
                    </div>
                    <div class="avatar-option" data-gender="female">
                        <img src="https://abrehamrahi.ir/s/u/7FV9CmVi/" alt="آواتار زن">
                    </div>
                </div>
            </div>
            
            <button class="login-btn" id="loginBtn">ورود به اپلیکیشن</button>
            
            <div class="register-link">
                <a href="#" id="showRegister">حساب کاربری ندارید؟ ثبت نام کنید</a>
            </div>
        </div>
    </div>
    
    <!-- صفحه اصلی -->
    <div id="mainPage" class="main-container hidden">
        <video class="video-background" autoplay muted loop>
            <source src="https://abrehamrahi.ir/s/u/pOu1w9TL/" type="video/mp4">
            مرورگر شما از ویدیو پشتیبانی نمی‌کند
        </video>
        
        <div class="start-game">
            <img src="https://abrehamrahi.ir/s/u/kSsMksqs/" alt="شروع بازی">
        </div>
        
        <div class="coins-display">
            <span id="userCoins">1250</span>
            <img src="https://abrehamrahi.ir/s/u/32spCdLc/" alt="سکه">
        </div>
        
        <div class="profile-section" id="profileBtn">
            <div class="profile-avatar-container">
                <img src="https://abrehamrahi.ir/s/u/QUN6k3Xo/" alt="قاب" class="profile-avatar-frame" id="userAvatarFrame">
                <div class="profile-avatar">
                    <img src="https://abrehamrahi.ir/s/u/gS4i0cw6/" alt="آواتار کاربر" id="userAvatar">
                </div>
            </div>
            <div class="profile-info">
                <div class="profile-name" id="userName">خلیل</div>
                <div class="profile-stats">سطح: 15 | پیروزی: 42</div>
            </div>
        </div>
        
        <div class="bottom-nav">
            <div class="nav-item" id="groupBtn">
                <img src="https://abrehamrahi.ir/s/u/1uGNXlcb/" alt="گروه">
            </div>
            <div class="nav-item" id="homeBtn">
                <img src="https://abrehamrahi.ir/s/u/EN2fA5sg/" alt="خانه">
            </div>
            <div class="nav-item" id="shopBtn">
                <img src="https://abrehamrahi.ir/s/u/OFd3s7WL/" alt="فروشگاه">
            </div>
        </div>
    </div>
    
    <!-- صفحه دوستانه -->
    <div id="friendsPage" class="friends-container hidden">
        <div class="back-btn" id="backFromFriends">
            <img src="https://abrehamrahi.ir/s/u/zQw5l6La/" alt="بازگشت">
        </div>
        
        <h2 style="color: #ffd700; margin-bottom: 20px; text-shadow: 0 0 10px rgba(255,215,0,0.5);">لابی‌های دوستانه</h2>
        
        <div class="lobbies-container" id="lobbiesList">
            <!-- لابی‌ها در اینجا نمایش داده می‌شوند -->
        </div>
        
        <div class="create-lobby" id="createLobbyBtn">
            <img src="https://abrehamrahi.ir/s/u/MxQf8nzH/" alt="ساخت لابی">
        </div>
    </div>
    
    <!-- صفحه ایجاد لابی -->
    <div id="createLobbyPage" class="create-lobby-container hidden">
        <div class="back-btn" id="backFromCreateLobby">
            <img src="https://abrehamrahi.ir/s/u/zQw5l6La/" alt="بازگشت">
        </div>
        
        <div class="lobby-form">
            <h2 class="lobby-title">ایجاد لابی جدید</h2>
            
            <div class="lobby-input-group">
                <label for="lobbyName">نام لابی</label>
                <input type="text" id="lobbyName" placeholder="اینجا لابی">
            </div>
            
            <div class="lobby-input-group">
                <label>انتخاب صندلی</label>
                <div class="lobby-options" id="seatOptions">
                    <!-- فقط یک صندلی نمایش داده می‌شود -->
                    <div class="lobby-option selected" data-seat="1">
                        <img src="https://abrehamrahi.ir/s/u/pXkLcMSf/" alt="صندلی 1">
                        <div>صندلی 1</div>
                    </div>
                </div>
            </div>
            
            <div class="lobby-input-group">
                <label>انتخاب پس زمینه</label>
                <div class="lobby-options" id="backgroundOptions">
                    <div class="lobby-option selected" data-background="1">
                        <img src="https://abrehamrahi.ir/s/u/4AQA9Mfy/" alt="پس زمینه 1">
                        <div>پس زمینه 1</div>
                    </div>
                    <div class="lobby-option" data-background="2">
                        <img src="https://abrehamrahi.ir/s/u/3gpsFN5K/" alt="پس زمینه 2">
                        <div>پس زمینه 2</div>
                    </div>
                </div>
            </div>
            
            <button class="create-lobby-btn" id="createLobbyFinalBtn">ایجاد لابی</button>
        </div>
    </div>
    
    <!-- صفحه لابی -->
    <div id="lobbyPage" class="lobby-container hidden">
        <img class="lobby-background" id="lobbyBackground" src="https://abrehamrahi.ir/s/u/4AQA9Mfy/" alt="پس زمینه لابی">
        
        <div class="lobby-back-btn" id="backFromLobby">
            <img src="https://abrehamrahi.ir/s/u/zQw5l6La/" alt="بازگشت">
        </div>
        
        <div class="lobby-info-header">
            <div class="lobby-title" id="lobbyTitle">لابی دوستانه</div>
            <div class="lobby-creator-name" id="lobbyCreatorName">سازنده: شما</div>
        </div>
        
        <div class="seats-container" id="seatsContainer">
            <!-- صندلی‌ها در اینجا نمایش داده می‌شوند -->
        </div>
        
        <div class="lobby-controls">
            <div class="lobby-control mic-control" id="micControl">
                <img src="https://abrehamrahi.ir/s/u/JglpTx4Q/" alt="میکروفن">
                <div class="mic-status" id="micStatus"></div>
            </div>
            <div class="lobby-control" id="likeControl">
                <img src="https://abrehamrahi.ir/s/u/NEmspM8t/" alt="لایک">
            </div>
            <div class="lobby-control" id="dislikeControl">
                <img src="https://abrehamrahi.ir/s/u/Pi961KeE/" alt="دیس لایک">
            </div>
        </div>
        
        <div class="lobby-chat" id="lobbyChat">
            <!-- پیام‌های چت در اینجا نمایش داده می‌شوند -->
        </div>
        
        <!-- واکنش بزرگ در مرکز صفحه -->
        <div id="fullscreenReaction" class="fullscreen-reaction hidden"></div>
    </div>
    
    <!-- صفحه پروفایل -->
    <div id="profilePage" class="profile-page hidden">
        <div class="back-btn" id="backFromProfile">
            <img src="https://abrehamrahi.ir/s/u/zQw5l6La/" alt="بازگشت">
        </div>
        
        <div class="profile-header">
            <div class="profile-avatar-large-container">
                <img src="https://abrehamrahi.ir/s/u/QUN6k3Xo/" alt="قاب" class="profile-frame-large" id="profileFrame">
                <div class="profile-avatar-large">
                    <img src="https://abrehamrahi.ir/s/u/gS4i0cw6/" alt="آواتار کاربر" id="profileAvatar">
                </div>
            </div>
            <div class="profile-details">
                <h2 id="profileUserName">خلیل</h2>
                <div class="profile-stats-grid">
                    <div class="stat-item">
                        <div class="stat-value">42</div>
                        <div class="stat-label">پیروزی</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">18</div>
                        <div class="stat-label">باخت</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">3:25:14</div>
                        <div class="stat-label">ساعت بازی</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">12</div>
                        <div class="stat-label">ناظر</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="profile-tabs">
            <div class="tab active" data-tab="avatars">آواتارهای من</div>
            <div class="tab" data-tab="frames">قالب‌های من</div>
            <div class="tab" data-tab="buy">خرید آواتار</div>
        </div>
        
        <div id="avatarsTab" class="tab-content">
            <div class="avatar-grid" id="myAvatarsGrid">
                <!-- آواتارهای کاربر در اینجا نمایش داده می‌شوند -->
            </div>
        </div>
        
        <div id="framesTab" class="tab-content hidden">
            <div class="frame-grid" id="myFramesGrid">
                <!-- قالب‌های کاربر در اینجا نمایش داده می‌شوند -->
            </div>
        </div>
        
        <div id="buyTab" class="tab-content hidden">
            <h3>آواتارهای قابل خرید</h3>
            <div class="avatar-grid" id="buyAvatarsGrid">
                <!-- آواتارهای قابل خرید در اینجا نمایش داده می‌شوند -->
            </div>
            
            <h3 style="margin-top: 30px;">قالب‌های قابل خرید</h3>
            <div class="frame-grid" id="buyFramesGrid">
                <!-- قالب‌های قابل خرید در اینجا نمایش داده می‌شوند -->
            </div>
        </div>
    </div>
    
    <!-- صفحه فروشگاه -->
    <div id="shopPage" class="shop-container hidden">
        <div class="back-btn" id="backFromShop">
            <img src="https://abrehamrahi.ir/s/u/zQw5l6La/" alt="بازگشت">
        </div>
        
        <h2 style="color: #ffd700; margin-top: 30px; text-shadow: 0 0 10px rgba(255,215,0,0.5);">فروشگاه Mafia Safe</h2>
        
        <div class="shop-items" id="shopItems">
            <!-- فروشگاه خالی است -->
            <div class="empty-shop">
                در حال حاضر هیچ آیتمی برای فروش وجود ندارد
            </div>
        </div>
    </div>
    
    <!-- صفحه گروه -->
    <div id="groupPage" class="group-container hidden">
        <div class="back-btn" id="backFromGroup">
            <img src="https://abrehamrahi.ir/s/u/zQw5l6La/" alt="بازگشت">
        </div>
        
        <h2 style="color: #ffd700; margin-bottom: 20px; text-shadow: 0 0 10px rgba(255,215,0,0.5);">گروه‌های دوستانه</h2>
        
        <div class="group-list" id="groupList">
            <div class="group-item">
                <div class="group-avatar">
                    <img src="https://abrehamrahi.ir/s/u/gS4i0cw6/" alt="آواتار گروه">
                </div>
                <div class="group-info">
                    <div class="group-name">گروه مافیا بازان</div>
                    <div class="group-members">12 عضو</div>
                </div>
            </div>
            <div class="group-item">
                <div class="group-avatar">
                    <img src="https://abrehamrahi.ir/s/u/7FV9CmVi/" alt="آواتار گروه">
                </div>
                <div class="group-info">
                    <div class="group-name">باشگاه شبانه</div>
                    <div class="group-members">8 عضو</div>
                </div>
            </div>
            <div class="group-item">
                <div class="group-avatar">
                    <img src="https://abrehamrahi.ir/s/u/fbVBeoFU/" alt="آواتار گروه">
                </div>
                <div class="group-info">
                    <div class="group-name">تیم حرفه‌ای</div>
                    <div class="group-members">15 عضو</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // داده‌های لابی‌ها - بدون بات و فقط لابی‌های واقعی کاربران
        let myLobbies = [];
        
        // متغیرهای جهانی
        let currentLobby = null;
        let mySeatId = null;
        let isMicActive = false;
        
        // داده‌های آواتارها و قالب‌ها
        const availableAvatars = [
            { id: 1, url: "https://abrehamrahi.ir/s/u/gS4i0cw6/", name: "آواتار مرد", price: 0, owned: true },
            { id: 2, url: "https://abrehamrahi.ir/s/u/7FV9CmVi/", name: "آواتار زن", price: 500, owned: false },
            { id: 3, url: "https://abrehamrahi.ir/s/u/fbVBeoFU/", name: "آواتار طلایی", price: 1200, owned: false },
            { id: 4, url: "https://abrehamrahi.ir/s/u/47pJoWE8/", name: "آواتار جدید", price: 800, owned: false },
            { id: 5, url: "https://abrehamrahi.ir/s/u/QW6bkaSw/", name: "آواتار الماسی", price: 2000, owned: false }
        ];

        const availableFrames = [
            { id: 1, url: "https://abrehamrahi.ir/s/u/QUN6k3Xo/", name: "قالب طلایی", price: 0, owned: true },
            { id: 2, url: "https://abrehamrahi.ir/s/u/fbVBeoFU/", name: "قالب نقره‌ای", price: 1500, owned: false },
            { id: 3, url: "https://abrehamrahi.ir/s/u/47pJoWE8/", name: "قالب الماسی", price: 2500, owned: false }
        ];
        
        // کاربر فعلی
        let currentUser = {
            name: "خلیل",
            avatar: "https://abrehamrahi.ir/s/u/gS4i0cw6/",
            frame: "https://abrehamrahi.ir/s/u/QUN6k3Xo/",
            coins: 1250,
            ownedAvatars: ["https://abrehamrahi.ir/s/u/gS4i0cw6/"],
            ownedFrames: ["https://abrehamrahi.ir/s/u/QUN6k3Xo/"]
        };

        // عناصر DOM
        const loginPage = document.getElementById('loginPage');
        const mainPage = document.getElementById('mainPage');
        const friendsPage = document.getElementById('friendsPage');
        const createLobbyPage = document.getElementById('createLobbyPage');
        const lobbyPage = document.getElementById('lobbyPage');
        const profilePage = document.getElementById('profilePage');
        const shopPage = document.getElementById('shopPage');
        const groupPage = document.getElementById('groupPage');
        
        // دکمه‌های ناوبری
        const loginBtn = document.getElementById('loginBtn');
        const startGame = document.querySelector('.start-game');
        const profileBtn = document.getElementById('profileBtn');
        const homeBtn = document.getElementById('homeBtn');
        const groupBtn = document.getElementById('groupBtn');
        const shopBtn = document.getElementById('shopBtn');
        const createLobbyBtn = document.getElementById('createLobbyBtn');
        const createLobbyFinalBtn = document.getElementById('createLobbyFinalBtn');
        
        // دکمه‌های بازگشت
        const backFromFriends = document.getElementById('backFromFriends');
        const backFromLobby = document.getElementById('backFromLobby');
        const backFromCreateLobby = document.getElementById('backFromCreateLobby');
        const backFromProfile = document.getElementById('backFromProfile');
        const backFromShop = document.getElementById('backFromShop');
        const backFromGroup = document.getElementById('backFromGroup');
        
        // عناصر کاربر
        const userName = document.getElementById('userName');
        const userAvatar = document.getElementById('userAvatar');
        const userAvatarFrame = document.getElementById('userAvatarFrame');
        const userCoinsDisplay = document.getElementById('userCoins');
        const avatarOptions = document.querySelectorAll('.avatar-option');
        
        // عناصر لابی
        const lobbiesList = document.getElementById('lobbiesList');
        const seatsContainer = document.getElementById('seatsContainer');
        const lobbyTitle = document.getElementById('lobbyTitle');
        const lobbyCreatorName = document.getElementById('lobbyCreatorName');
        const lobbyBackground = document.getElementById('lobbyBackground');
        const micControl = document.getElementById('micControl');
        const micStatus = document.getElementById('micStatus');
        const likeControl = document.getElementById('likeControl');
        const dislikeControl = document.getElementById('dislikeControl');
        const lobbyChat = document.getElementById('lobbyChat');
        const fullscreenReaction = document.getElementById('fullscreenReaction');
        
        // عناصر صفحه ایجاد لابی
        const lobbyNameInput = document.getElementById('lobbyName');
        const seatOptions = document.querySelectorAll('#seatOptions .lobby-option');
        const backgroundOptions = document.querySelectorAll('#backgroundOptions .lobby-option');
        
        // عناصر صفحه پروفایل
        const profileUserName = document.getElementById('profileUserName');
        const profileAvatar = document.getElementById('profileAvatar');
        const profileFrame = document.getElementById('profileFrame');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const myAvatarsGrid = document.getElementById('myAvatarsGrid');
        const myFramesGrid = document.getElementById('myFramesGrid');
        const buyAvatarsGrid = document.getElementById('buyAvatarsGrid');
        const buyFramesGrid = document.getElementById('buyFramesGrid');
        
        // عناصر صفحه فروشگاه
        const shopItems = document.getElementById('shopItems');

        // تابع برای به‌روزرسانی نمایش کاربر در تمام صفحات
        function updateUserDisplay() {
            userName.textContent = currentUser.name;
            profileUserName.textContent = currentUser.name;
            userAvatar.src = currentUser.avatar;
            profileAvatar.src = currentUser.avatar;
            userAvatarFrame.src = currentUser.frame;
            profileFrame.src = currentUser.frame;
            userCoinsDisplay.textContent = currentUser.coins;
            
            // به‌روزرسانی صندلی کاربر در لابی فعلی
            if (currentLobby && mySeatId !== null) {
                const mySeat = currentLobby.seats.find(seat => seat.id === mySeatId);
                if (mySeat) {
                    mySeat.avatar = currentUser.avatar;
                    mySeat.frame = currentUser.frame;
                    loadSeats(); // بارگذاری مجدد صندلی‌ها
                }
            }
            
            // بارگذاری مجدد آواتارها و قالب‌های کاربر در صفحه پروفایل
            loadMyAvatars();
            loadMyFrames();
            loadBuyAvatars();
            loadBuyFrames();
        }

        // رویداد انتخاب آواتار
        avatarOptions.forEach(option => {
            option.addEventListener('click', function() {
                avatarOptions.forEach(opt => opt.classList.remove('selected'));
                this.classList.add('selected');
            });
        });

        // رویداد ورود
        loginBtn.addEventListener('click', function() {
            const phone = document.getElementById('phone').value;
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            // اعتبارسنجی ساده
            if (!phone || !username || !password || !confirmPassword) {
                alert('لطفاً تمام فیلدها را پر کنید');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('رمز عبور و تکرار آن مطابقت ندارند');
                return;
            }
            
            // ذخیره اطلاعات کاربر
            currentUser = {
                name: username,
                avatar: document.querySelector('.avatar-option.selected').getAttribute('data-gender') === 'male' 
                    ? 'https://abrehamrahi.ir/s/u/gS4i0cw6/' 
                    : 'https://abrehamrahi.ir/s/u/7FV9CmVi/',
                frame: "https://abrehamrahi.ir/s/u/QUN6k3Xo/",
                coins: 1250,
                ownedAvatars: ["https://abrehamrahi.ir/s/u/gS4i0cw6/"],
                ownedFrames: ["https://abrehamrahi.ir/s/u/QUN6k3Xo/"]
            };
            
            // نمایش اطلاعات کاربر
            updateUserDisplay();
            
            // رفتن به صفحه اصلی
            loginPage.classList.add('hidden');
            mainPage.classList.remove('hidden');
        });

        // رویداد شروع بازی (رفتن به صفحه دوستانه)
        startGame.addEventListener('click', function() {
            mainPage.classList.add('hidden');
            friendsPage.classList.remove('hidden');
            loadLobbies();
        });

        // رویداد بازگشت از صفحه دوستانه
        backFromFriends.addEventListener('click', function() {
            friendsPage.classList.add('hidden');
            mainPage.classList.remove('hidden');
        });

        // رویداد بازگشت از صفحه لابی
        backFromLobby.addEventListener('click', function() {
            lobbyPage.classList.add('hidden');
            friendsPage.classList.remove('hidden');
            
            // حذف کاربر از لابی
            if (currentLobby && mySeatId !== null) {
                const mySeat = currentLobby.seats.find(seat => seat.id === mySeatId);
                if (mySeat) {
                    mySeat.isMe = false;
                }
            }
            
            currentLobby = null;
            mySeatId = null;
            
            // بارگذاری مجدد لیست لابی‌ها
            loadLobbies();
        });

        // رویداد بازگشت از صفحه ایجاد لابی
        backFromCreateLobby.addEventListener('click', function() {
            createLobbyPage.classList.add('hidden');
            friendsPage.classList.remove('hidden');
        });

        // رویداد بازگشت از صفحه پروفایل
        backFromProfile.addEventListener('click', function() {
            profilePage.classList.add('hidden');
            mainPage.classList.remove('hidden');
        });

        // رویداد بازگشت از صفحه فروشگاه
        backFromShop.addEventListener('click', function() {
            shopPage.classList.add('hidden');
            mainPage.classList.remove('hidden');
        });

        // رویداد بازگشت از صفحه گروه
        backFromGroup.addEventListener('click', function() {
            groupPage.classList.add('hidden');
            mainPage.classList.remove('hidden');
        });

        // رویداد رفتن به صفحه پروفایل
        profileBtn.addEventListener('click', function() {
            mainPage.classList.add('hidden');
            profilePage.classList.remove('hidden');
            
            // بارگذاری آواتارها و قالب‌های کاربر
            loadMyAvatars();
            loadMyFrames();
            loadBuyAvatars();
            loadBuyFrames();
        });

        // رویداد رفتن به صفحه اصلی (خانه)
        homeBtn.addEventListener('click', function() {
            profilePage.classList.add('hidden');
            friendsPage.classList.add('hidden');
            shopPage.classList.add('hidden');
            groupPage.classList.add('hidden');
            mainPage.classList.remove('hidden');
        });

        // رویداد رفتن به صفحه فروشگاه
        shopBtn.addEventListener('click', function() {
            mainPage.classList.add('hidden');
            shopPage.classList.remove('hidden');
            // فروشگاه خالی است - هیچ آیتمی بارگذاری نمی‌شود
        });

        // رویداد رفتن به صفحه گروه
        groupBtn.addEventListener('click', function() {
            mainPage.classList.add('hidden');
            groupPage.classList.remove('hidden');
        });

        // رویداد رفتن به صفحه ایجاد لابی
        createLobbyBtn.addEventListener('click', function() {
            friendsPage.classList.add('hidden');
            createLobbyPage.classList.remove('hidden');
        });

        // رویداد ایجاد لابی نهایی
        createLobbyFinalBtn.addEventListener('click', function() {
            // ذخیره اطلاعات لابی
            const lobbyName = lobbyNameInput.value || "اینجا لابی";
            const selectedSeat = document.querySelector('#seatOptions .lobby-option.selected');
            const selectedBackground = document.querySelector('#backgroundOptions .lobby-option.selected');
            
            const seatId = selectedSeat ? selectedSeat.getAttribute('data-seat') : "1";
            const backgroundId = selectedBackground ? selectedBackground.getAttribute('data-background') : "1";
            
            // ایجاد لابی جدید
            const newLobby = {
                id: Date.now(), // استفاده از timestamp به عنوان ID
                name: lobbyName,
                creator: currentUser.name,
                creatorAvatar: currentUser.avatar,
                background: backgroundId === "1" ? "https://abrehamrahi.ir/s/u/4AQA9Mfy/" : "https://abrehamrahi.ir/s/u/3gpsFN5K/",
                seats: [
                    { 
                        id: parseInt(seatId), 
                        name: currentUser.name, 
                        avatar: currentUser.avatar,
                        frame: currentUser.frame,
                        isMe: true, 
                        like: false, 
                        dislike: false, 
                        micActive: false 
                    }
                ]
            };
            
            // اضافه کردن لابی به لیست لابی‌های من
            myLobbies.push(newLobby);
            
            // رفتن به صفحه لابی
            joinLobby(newLobby.id);
            
            // پاک کردن فرم
            lobbyNameInput.value = "";
        });

        // رویداد انتخاب صندلی
        seatOptions.forEach(option => {
            option.addEventListener('click', function() {
                seatOptions.forEach(opt => opt.classList.remove('selected'));
                this.classList.add('selected');
            });
        });

        // رویداد انتخاب پس زمینه
        backgroundOptions.forEach(option => {
            option.addEventListener('click', function() {
                backgroundOptions.forEach(opt => opt.classList.remove('selected'));
                this.classList.add('selected');
            });
        });

        // رویداد کنترل میکروفن
        micControl.addEventListener('click', function() {
            isMicActive = !isMicActive;
            
            if (isMicActive) {
                micStatus.classList.add('active');
                
                // نشان دادن نشانگر میکروفن فعال در صندلی کاربر
                if (mySeatId !== null) {
                    const mySeat = document.querySelector(`.seat[data-seat-id="${mySeatId}"]`);
                    if (mySeat) {
                        const micIndicator = mySeat.querySelector('.mic-indicator');
                        micIndicator.classList.add('mic-active');
                    }
                }
                
                addChatMessage("سیستم", "میکروفن شما فعال شد");
            } else {
                micStatus.classList.remove('active');
                
                // حذف نشانگر میکروفن فعال از صندلی کاربر
                if (mySeatId !== null) {
                    const mySeat = document.querySelector(`.seat[data-seat-id="${mySeatId}"]`);
                    if (mySeat) {
                        const micIndicator = mySeat.querySelector('.mic-indicator');
                        micIndicator.classList.remove('mic-active');
                    }
                }
                
                addChatMessage("سیستم", "میکروفن شما غیرفعال شد");
            }
        });

        // رویداد لایک
        likeControl.addEventListener('click', function() {
            // ایجاد واکنش موقت در صندلی کاربر
            createTemporaryReaction('like');
            
            // نمایش واکنش بزرگ در مرکز صفحه
            showFullscreenReaction('like');
            
            addChatMessage("سیستم", `${currentUser.name} لایک داد`);
        });

        // رویداد دیس لایک
        dislikeControl.addEventListener('click', function() {
            // ایجاد واکنش موقت در صندلی کاربر
            createTemporaryReaction('dislike');
            
            // نمایش واکنش بزرگ در مرکز صفحه
            showFullscreenReaction('dislike');
            
            addChatMessage("سیستم", `${currentUser.name} دیس لایک داد`);
        });

        // ایجاد واکنش موقت در صندلی کاربر
        function createTemporaryReaction(type) {
            if (mySeatId === null) return;
            
            const mySeat = document.querySelector(`.seat[data-seat-id="${mySeatId}"]`);
            if (!mySeat) return;
            
            const reactionsContainer = mySeat.querySelector('.seat-reactions');
            
            // پاک کردن واکنش‌های قبلی
            reactionsContainer.innerHTML = '';
            
            // ایجاد واکنش جدید
            const reactionElement = document.createElement('div');
            reactionElement.className = `reaction ${type === 'like' ? 'reaction-temporary' : 'dislike-temporary'}`;
            
            if (type === 'like') {
                reactionElement.innerHTML = '<img src="https://abrehamrahi.ir/s/u/NEmspM8t/" alt="لایک">';
            } else {
                reactionElement.innerHTML = '<img src="https://abrehamrahi.ir/s/u/Pi961KeE/" alt="دیس لایک">';
            }
            
            reactionsContainer.appendChild(reactionElement);
            
            // حذف واکنش پس از ۳ ثانیه
            setTimeout(() => {
                if (reactionsContainer.contains(reactionElement)) {
                    reactionsContainer.removeChild(reactionElement);
                }
            }, 3000);
        }

        // نمایش واکنش بزرگ در مرکز صفحه
        function showFullscreenReaction(type) {
            fullscreenReaction.innerHTML = '';
            
            const reactionElement = document.createElement('div');
            
            if (type === 'like') {
                reactionElement.innerHTML = '<img src="https://abrehamrahi.ir/s/u/NEmspM8t/" alt="لایک">';
            } else {
                reactionElement.innerHTML = '<img src="https://abrehamrahi.ir/s/u/Pi961KeE/" alt="دیس لایک">';
            }
            
            fullscreenReaction.appendChild(reactionElement);
            fullscreenReaction.classList.remove('hidden');
            
            // حذف واکنش پس از ۳ ثانیه
            setTimeout(() => {
                fullscreenReaction.classList.add('hidden');
            }, 3000);
        }

        // بارگذاری لیست لابی‌ها
        function loadLobbies() {
            lobbiesList.innerHTML = '';
            
            // فقط لابی‌های من نمایش داده می‌شوند
            if (myLobbies.length === 0) {
                const emptyMessage = document.createElement('div');
                emptyMessage.className = 'empty-lobbies';
                emptyMessage.textContent = 'هیچ لابی فعالی وجود ندارد. اولین نفری باشید که لابی ایجاد می‌کند!';
                lobbiesList.appendChild(emptyMessage);
                return;
            }
            
            myLobbies.forEach(lobby => {
                const lobbyItem = document.createElement('div');
                lobbyItem.className = 'lobby-item';
                lobbyItem.innerHTML = `
                    <div class="lobby-avatar">
                        <img src="${currentUser.frame}" alt="قاب" class="lobby-avatar-frame">
                        <div class="lobby-avatar-img">
                            <img src="${lobby.creatorAvatar}" alt="آواتار سازنده">
                        </div>
                    </div>
                    <div class="lobby-info">
                        <div class="lobby-name">${lobby.name}</div>
                        <div class="lobby-creator">سازنده: ${lobby.creator}</div>
                        <div class="lobby-creator">تعداد بازیکنان: ${lobby.seats.length}/10</div>
                    </div>
                    <button class="join-btn" data-lobby-id="${lobby.id}">پیوستن</button>
                `;
                
                const joinBtn = lobbyItem.querySelector('.join-btn');
                joinBtn.addEventListener('click', () => {
                    joinLobby(lobby.id);
                });
                
                lobbiesList.appendChild(lobbyItem);
            });
        }

        // پیوستن به لابی
        function joinLobby(lobbyId) {
            // پیدا کردن لابی در لیست لابی‌های من
            currentLobby = myLobbies.find(lobby => lobby.id === lobbyId);
            
            if (!currentLobby) {
                alert('لابی مورد نظر پیدا نشد');
                return;
            }
            
            // پیدا کردن صندلی کاربر
            const mySeat = currentLobby.seats.find(seat => seat.isMe);
            if (mySeat) {
                mySeatId = mySeat.id;
                // به‌روزرسانی آواتار و قالب کاربر در لابی
                mySeat.avatar = currentUser.avatar;
                mySeat.frame = currentUser.frame;
            }
            
            // نمایش اطلاعات لابی
            lobbyTitle.textContent = currentLobby.name;
            lobbyCreatorName.textContent = `سازنده: ${currentLobby.creator}`;
            lobbyBackground.src = currentLobby.background;
            
            // بارگذاری صندلی‌ها
            loadSeats();
            
            // پاک کردن چت و اضافه کردن پیام خوش‌آمدگویی
            lobbyChat.innerHTML = '';
            addChatMessage("سیستم", `به لابی "${currentLobby.name}" خوش آمدید!`);
            
            // رفتن به صفحه لابی
            friendsPage.classList.add('hidden');
            createLobbyPage.classList.add('hidden');
            lobbyPage.classList.remove('hidden');
        }

        // بارگذاری صندلی‌ها
        function loadSeats() {
            if (!currentLobby) return;
            
            seatsContainer.innerHTML = '';
            
            currentLobby.seats.forEach(seat => {
                const seatElement = document.createElement('div');
                seatElement.className = 'seat';
                seatElement.setAttribute('data-seat-id', seat.id);
                
                seatElement.innerHTML = `
                    <div class="seat-number">${seat.id}</div>
                    <div class="seat-chair"></div>
                    <div class="seat-avatar-container">
                        <img src="${seat.frame || currentUser.frame}" alt="قاب" class="seat-avatar-frame">
                        <div class="seat-avatar">
                            <img src="${seat.avatar}" alt="آواتار">
                        </div>
                    </div>
                    <div class="seat-name">${seat.name}</div>
                    <div class="seat-reactions">
                        ${seat.like ? '<div class="reaction"><img src="https://abrehamrahi.ir/s/u/NEmspM8t/" alt="لایک"></div>' : ''}
                        ${seat.dislike ? '<div class="reaction"><img src="https://abrehamrahi.ir/s/u/Pi961KeE/" alt="دیس لایک"></div>' : ''}
                    </div>
                    <div class="mic-indicator ${seat.micActive ? 'mic-active' : ''}"></div>
                `;
                
                seatsContainer.appendChild(seatElement);
            });
            
            // اضافه کردن صندلی‌های خالی
            const totalSeats = 10;
            for (let i = currentLobby.seats.length + 1; i <= totalSeats; i++) {
                const emptySeat = document.createElement('div');
                emptySeat.className = 'seat';
                emptySeat.setAttribute('data-seat-id', i);
                
                emptySeat.innerHTML = `
                    <div class="seat-number">${i}</div>
                    <div class="seat-chair"></div>
                    <div class="seat-avatar-container">
                        <img src="${currentUser.frame}" alt="قاب" class="seat-avatar-frame">
                        <div class="seat-avatar">
                            <div style="width: 100%; height: 100%; background: #333; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #666; font-size: 10px;">خالی</div>
                        </div>
                    </div>
                    <div class="seat-name">صندلی خالی</div>
                    <div class="seat-reactions"></div>
                    <div class="mic-indicator"></div>
                `;
                
                seatsContainer.appendChild(emptySeat);
            }
        }

        // اضافه کردن پیام به چت
        function addChatMessage(sender, message) {
            const messageElement = document.createElement('div');
            messageElement.className = 'chat-message';
            messageElement.innerHTML = `<span class="sender">${sender}:</span> ${message}`;
            
            lobbyChat.appendChild(messageElement);
            lobbyChat.scrollTop = lobbyChat.scrollHeight;
        }

        // رویداد تغییر تب‌ها در صفحه پروفایل
        tabs.forEach(tab => {
            tab.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                
                // حذف کلاس active از همه تب‌ها
                tabs.forEach(t => t.classList.remove('active'));
                // اضافه کردن کلاس active به تب انتخاب شده
                this.classList.add('active');
                
                // مخفی کردن همه محتواها
                tabContents.forEach(content => content.classList.add('hidden'));
                // نمایش محتوای تب انتخاب شده
                document.getElementById(tabId + 'Tab').classList.remove('hidden');
            });
        });

        // بارگذاری آواتارهای کاربر
        function loadMyAvatars() {
            myAvatarsGrid.innerHTML = '';
            
            availableAvatars.forEach(avatar => {
                if (currentUser.ownedAvatars.includes(avatar.url)) {
                    const avatarItem = document.createElement('div');
                    avatarItem.className = `avatar-item ${currentUser.avatar === avatar.url ? 'selected' : ''}`;
                    avatarItem.innerHTML = `
                        <img src="${avatar.url}" alt="آواتار">
                        <div>${avatar.name}</div>
                        <button class="buy-btn use-avatar-btn" data-avatar-url="${avatar.url}">${currentUser.avatar === avatar.url ? 'در حال استفاده' : 'استفاده'}</button>
                    `;
                    
                    const useBtn = avatarItem.querySelector('.use-avatar-btn');
                    useBtn.addEventListener('click', function() {
                        if (currentUser.avatar !== avatar.url) {
                            currentUser.avatar = avatar.url;
                            updateUserDisplay();
                        }
                    });
                    
                    myAvatarsGrid.appendChild(avatarItem);
                }
            });
        }

        // بارگذاری قالب‌های کاربر
        function loadMyFrames() {
            myFramesGrid.innerHTML = '';
            
            availableFrames.forEach(frame => {
                if (currentUser.ownedFrames.includes(frame.url)) {
                    const frameItem = document.createElement('div');
                    frameItem.className = `frame-item ${currentUser.frame === frame.url ? 'selected' : ''}`;
                    frameItem.innerHTML = `
                        <img src="${frame.url}" alt="قالب">
                        <div>${frame.name}</div>
                        <button class="buy-btn use-frame-btn" data-frame-url="${frame.url}">${currentUser.frame === frame.url ? 'در حال استفاده' : 'استفاده'}</button>
                    `;
                    
                    const useBtn = frameItem.querySelector('.use-frame-btn');
                    useBtn.addEventListener('click', function() {
                        if (currentUser.frame !== frame.url) {
                            currentUser.frame = frame.url;
                            updateUserDisplay();
                        }
                    });
                    
                    myFramesGrid.appendChild(frameItem);
                }
            });
        }

        // بارگذاری آواتارهای قابل خرید
        function loadBuyAvatars() {
            buyAvatarsGrid.innerHTML = '';
            
            availableAvatars.forEach(avatar => {
                if (!currentUser.ownedAvatars.includes(avatar.url)) {
                    const avatarItem = document.createElement('div');
                    avatarItem.className = 'avatar-item';
                    avatarItem.innerHTML = `
                        <img src="${avatar.url}" alt="آواتار">
                        <div>${avatar.name}</div>
                        <div class="avatar-price">${avatar.price} سکه</div>
                        <button class="buy-btn buy-avatar-btn" data-avatar-id="${avatar.id}" data-price="${avatar.price}">خرید</button>
                    `;
                    
                    const buyBtn = avatarItem.querySelector('.buy-avatar-btn');
                    buyBtn.addEventListener('click', function() {
                        const avatarId = this.getAttribute('data-avatar-id');
                        const price = parseInt(this.getAttribute('data-price'));
                        
                        if (currentUser.coins >= price) {
                            currentUser.coins -= price;
                            const avatar = availableAvatars.find(a => a.id == avatarId);
                            currentUser.ownedAvatars.push(avatar.url);
                            updateUserDisplay();
                            alert('آواتار با موفقیت خریداری شد!');
                        } else {
                            alert('سکه کافی ندارید!');
                        }
                    });
                    
                    buyAvatarsGrid.appendChild(avatarItem);
                }
            });
        }

        // بارگذاری قالب‌های قابل خرید
        function loadBuyFrames() {
            buyFramesGrid.innerHTML = '';
            
            availableFrames.forEach(frame => {
                if (!currentUser.ownedFrames.includes(frame.url)) {
                    const frameItem = document.createElement('div');
                    frameItem.className = 'frame-item';
                    frameItem.innerHTML = `
                        <img src="${frame.url}" alt="قالب">
                        <div>${frame.name}</div>
                        <div class="frame-price">${frame.price} سکه</div>
                        <button class="buy-btn buy-frame-btn" data-frame-id="${frame.id}" data-price="${frame.price}">خرید</button>
                    `;
                    
                    const buyBtn = frameItem.querySelector('.buy-frame-btn');
                    buyBtn.addEventListener('click', function() {
                        const frameId = this.getAttribute('data-frame-id');
                        const price = parseInt(this.getAttribute('data-price'));
                        
                        if (currentUser.coins >= price) {
                            currentUser.coins -= price;
                            const frame = availableFrames.find(f => f.id == frameId);
                            currentUser.ownedFrames.push(frame.url);
                            updateUserDisplay();
                            alert('قالب با موفقیت خریداری شد!');
                        } else {
                            alert('سکه کافی ندارید!');
                        }
                    });
                    
                    buyFramesGrid.appendChild(frameItem);
                }
            });
        }

        // مقداردهی اولیه
        // تنظیم مقدار پیش‌فرض برای نام لابی
        lobbyNameInput.value = "اینجا لابی";
        
        // بارگذاری اولیه اطلاعات کاربر
        updateUserDisplay();
    </script>
</body>
</html>